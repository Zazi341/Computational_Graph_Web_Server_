<!DOCTYPE HTML>
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc (11.0.25) on Fri Jul 18 15:02:04 IDT 2025 -->
<title>ConfLoader</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="dc.created" content="2025-07-18">
<link rel="stylesheet" type="text/css" href="../stylesheet.css" title="Style">
<link rel="stylesheet" type="text/css" href="../jquery/jquery-ui.min.css" title="Style">
<link rel="stylesheet" type="text/css" href="../jquery-ui.overrides.css" title="Style">
<script type="text/javascript" src="../script.js"></script>
<script type="text/javascript" src="../jquery/jszip/dist/jszip.min.js"></script>
<script type="text/javascript" src="../jquery/jszip-utils/dist/jszip-utils.min.js"></script>
<!--[if IE]>
<script type="text/javascript" src="../jquery/jszip-utils/dist/jszip-utils-ie.min.js"></script>
<![endif]-->
<script type="text/javascript" src="../jquery/jquery-3.7.1.min.js"></script>
<script type="text/javascript" src="../jquery/jquery-ui.min.js"></script>
</head>
<body>
<script type="text/javascript"><!--
    try {
        if (location.href.indexOf('is-external=true') == -1) {
            parent.document.title="ConfLoader";
        }
    }
    catch(err) {
    }
//-->
var data = {"i0":10,"i1":10};
var tabs = {65535:["t0","All Methods"],2:["t2","Instance Methods"],8:["t4","Concrete Methods"]};
var altColor = "altColor";
var rowColor = "rowColor";
var tableTab = "tableTab";
var activeTableTab = "activeTableTab";
var pathtoroot = "../";
var useModuleDirectories = true;
loadScripts(document, 'script');</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<header role="banner">
<nav role="navigation">
<div class="fixedNav">
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a id="navbar.top">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.top" title="Skip navigation links">Skip navigation links</a></div>
<a id="navbar.top.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../index.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../deprecated-list.html">Deprecated</a></li>
<li><a href="../index-all.html">Index</a></li>
<li><a href="../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../allclasses.html">All&nbsp;Classes</a></li>
</ul>
<ul class="navListSearch">
<li><label for="search">SEARCH:</label>
<input type="text" id="search" value="search" disabled="disabled">
<input type="reset" id="reset" value="reset" disabled="disabled">
</li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor.summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor.detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a id="skip.navbar.top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
</div>
<div class="navPadding">&nbsp;</div>
<script type="text/javascript"><!--
$('.navPadding').css('padding-top', $('.fixedNav').css("height"));
//-->
</script>
</nav>
</header>
<!-- ======== START OF CLASS DATA ======== -->
<main role="main">
<div class="header">
<div class="subTitle"><span class="packageLabelInType">Package</span>&nbsp;<a href="package-summary.html">servlets</a></div>
<h2 title="Class ConfLoader" class="title">Class ConfLoader</h2>
</div>
<div class="contentContainer">
<ul class="inheritance">
<li>java.lang.Object</li>
<li>
<ul class="inheritance">
<li>servlets.ConfLoader</li>
</ul>
</li>
</ul>
<div class="description">
<ul class="blockList">
<li class="blockList">
<dl>
<dt>All Implemented Interfaces:</dt>
<dd><code><a href="Servlet.html" title="interface in servlets">Servlet</a></code></dd>
</dl>
<hr>
<pre>public class <span class="typeNameLabel">ConfLoader</span>
extends java.lang.Object
implements <a href="Servlet.html" title="interface in servlets">Servlet</a></pre>
<div class="block">ConfLoader servlet handles configuration file uploads via HTTP POST requests and generates
 graph visualizations. This servlet processes multipart form data containing configuration
 files, parses them using GenericConfig, and returns HTML graph visualizations.
 
 <p>The servlet supports the following workflow:
 <ol>
 <li>Receives multipart form data with configuration file content</li>
 <li>Extracts filename and file content from the multipart data</li>
 <li>Saves the configuration file to the config_files directory</li>
 <li>Clears existing topics and agents from the system</li>
 <li>Loads the new configuration using GenericConfig</li>
 <li>Generates and returns HTML graph visualization</li>
 </ol>
 
 <h3>Supported HTTP Methods</h3>
 <ul>
 <li><strong>POST</strong> - Upload configuration file and generate graph</li>
 </ul>
 
 <h3>Request Format</h3>
 <p>Expects multipart/form-data with a file field containing the configuration file:
 <pre><code>
 POST /config HTTP/1.1
 Content-Type: multipart/form-data; boundary=----WebKitFormBoundary...
 
 ------WebKitFormBoundary...
 Content-Disposition: form-data; name="file"; filename="example.conf"
 Content-Type: text/plain
 
 configs.PlusAgent
 input1,input2
 output1
 ------WebKitFormBoundary...--
 </code></pre>
 
 <h3>Response Format</h3>
 <p>Returns HTML content with the graph visualization:
 <ul>
 <li><strong>Success (200 OK)</strong> - HTML page with SVG/Canvas graph visualization</li>
 <li><strong>Error (200 OK)</strong> - HTML error page with error message and back button</li>
 </ul>
 
 <h3>Configuration File Format</h3>
 <p>The uploaded configuration file must follow the 3-line format per agent:
 <pre><code>
 configs.PlusAgent          # Agent class name
 topic1,topic2             # Input topics (comma-separated)
 result                    # Output topics (comma-separated)
 
 configs.IncAgent
 result                    # Input topics
 final                     # Output topics
 </code></pre>
 
 <h3>Error Handling</h3>
 <p>The servlet handles various error conditions:
 <ul>
 <li>Empty or missing configuration content</li>
 <li>Invalid multipart form data format</li>
 <li>Configuration file parsing errors</li>
 <li>Agent instantiation failures</li>
 <li>File system errors during configuration saving</li>
 </ul>
 
 <h3>Integration with System Components</h3>
 <ul>
 <li><strong>GenericConfig</strong> - Used for parsing and loading configuration files</li>
 <li><strong>TopicManagerSingleton</strong> - Manages topic lifecycle and clearing</li>
 <li><strong>HtmlGraphWriter</strong> - Generates HTML graph visualizations</li>
 </ul>
 
 <h3>Thread Safety</h3>
 <p>This servlet maintains a static reference to the current configuration and properly
 handles cleanup of previous configurations. The servlet is thread-safe for concurrent
 requests, though configuration loading is synchronized through the singleton pattern.</div>
<dl>
<dt><span class="simpleTagLabel">Since:</span></dt>
<dd>1.0</dd>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><a href="../configs/GenericConfig.html#setConfFile(java.lang.String)"><code>GenericConfig.setConfFile(String)</code></a>, 
<a href="../configs/GenericConfig.html#create()"><code>GenericConfig.create()</code></a>, 
<code>TopicManagerSingleton#clear()</code>, 
<a href="../views/HtmlGraphWriter.html#getGraphHTML()"><code>HtmlGraphWriter.getGraphHTML()</code></a>, 
<a href="Servlet.html#handle(server.RequestParser.RequestInfo,java.io.OutputStream)"><code>Servlet.handle(RequestInfo, OutputStream)</code></a></dd>
</dl>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- ======== CONSTRUCTOR SUMMARY ======== -->
<section>
<ul class="blockList">
<li class="blockList"><a id="constructor.summary">
<!--   -->
</a>
<h3>Constructor Summary</h3>
<table class="memberSummary">
<caption><span>Constructors</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Constructor</th>
<th class="colLast" scope="col">Description</th>
</tr>
<tr class="altColor">
<th class="colConstructorName" scope="row"><code><span class="memberNameLink"><a href="#%3Cinit%3E()">ConfLoader</a></span>()</code></th>
<td class="colLast">&nbsp;</td>
</tr>
</table>
</li>
</ul>
</section>
<!-- ========== METHOD SUMMARY =========== -->
<section>
<ul class="blockList">
<li class="blockList"><a id="method.summary">
<!--   -->
</a>
<h3>Method Summary</h3>
<table class="memberSummary">
<caption><span id="t0" class="activeTableTab"><span>All Methods</span><span class="tabEnd">&nbsp;</span></span><span id="t2" class="tableTab"><span><a href="javascript:show(2);">Instance Methods</a></span><span class="tabEnd">&nbsp;</span></span><span id="t4" class="tableTab"><span><a href="javascript:show(8);">Concrete Methods</a></span><span class="tabEnd">&nbsp;</span></span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colSecond" scope="col">Method</th>
<th class="colLast" scope="col">Description</th>
</tr>
<tr id="i0" class="altColor">
<td class="colFirst"><code>void</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#close()">close</a></span>()</code></th>
<td class="colLast">
<div class="block">Releases any resources held by this servlet and performs cleanup operations.</div>
</td>
</tr>
<tr id="i1" class="rowColor">
<td class="colFirst"><code>void</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#handle(server.RequestParser.RequestInfo,java.io.OutputStream)">handle</a></span>&#8203;(<a href="../server/RequestParser.RequestInfo.html" title="class in server">RequestParser.RequestInfo</a>&nbsp;ri,
      java.io.OutputStream&nbsp;toClient)</code></th>
<td class="colLast">
<div class="block">Handles HTTP POST requests containing configuration file uploads in multipart form data format.</div>
</td>
</tr>
</table>
<ul class="blockList">
<li class="blockList"><a id="methods.inherited.from.class.java.lang.Object">
<!--   -->
</a>
<h3>Methods inherited from class&nbsp;java.lang.Object</h3>
<code>clone, equals, finalize, getClass, hashCode, notify, notifyAll, toString, wait, wait, wait</code></li>
</ul>
</li>
</ul>
</section>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ========= CONSTRUCTOR DETAIL ======== -->
<section>
<ul class="blockList">
<li class="blockList"><a id="constructor.detail">
<!--   -->
</a>
<h3>Constructor Detail</h3>
<a id="&lt;init&gt;()">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>ConfLoader</h4>
<pre>public&nbsp;ConfLoader()</pre>
</li>
</ul>
</li>
</ul>
</section>
<!-- ============ METHOD DETAIL ========== -->
<section>
<ul class="blockList">
<li class="blockList"><a id="method.detail">
<!--   -->
</a>
<h3>Method Detail</h3>
<a id="handle(server.RequestParser.RequestInfo,java.io.OutputStream)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>handle</h4>
<pre class="methodSignature">public&nbsp;void&nbsp;handle&#8203;(<a href="../server/RequestParser.RequestInfo.html" title="class in server">RequestParser.RequestInfo</a>&nbsp;ri,
                   java.io.OutputStream&nbsp;toClient)
            throws java.io.IOException</pre>
<div class="block">Handles HTTP POST requests containing configuration file uploads in multipart form data format.
 This method processes the uploaded configuration file, clears existing system state, loads the
 new configuration, and returns an HTML graph visualization.
 
 <p>The method performs the following operations in sequence:
 <ol>
 <li>Extracts and validates multipart form data from the request</li>
 <li>Parses filename and file content from the multipart data</li>
 <li>Saves the configuration file to the config_files directory</li>
 <li>Closes any existing configuration and clears all topics</li>
 <li>Creates a new GenericConfig instance and loads the configuration</li>
 <li>Generates HTML graph visualization using HtmlGraphWriter</li>
 <li>Returns the HTML response with embedded refresh scripts</li>
 </ol>
 
 <h3>Request Processing</h3>
 <p>The method expects the request to contain multipart/form-data with a file field.
 The file content is extracted using custom multipart parsing logic that handles
 boundary detection and content extraction.
 
 <h3>System State Management</h3>
 <p>Before loading a new configuration, the method:
 <ul>
 <li>Closes the previous GenericConfig instance if it exists</li>
 <li>Clears all topics from TopicManagerSingleton</li>
 <li>Verifies that the clearing operation was successful</li>
 </ul>
 
 <h3>Error Handling</h3>
 <p>The method handles various error conditions gracefully:
 <ul>
 <li>Empty or missing request content</li>
 <li>Invalid multipart form data structure</li>
 <li>Configuration file parsing errors</li>
 <li>Agent instantiation failures</li>
 <li>File system I/O errors</li>
 </ul>
 All errors result in HTML error pages being returned to the client.</div>
<dl>
<dt><span class="overrideSpecifyLabel">Specified by:</span></dt>
<dd><code><a href="Servlet.html#handle(server.RequestParser.RequestInfo,java.io.OutputStream)">handle</a></code>&nbsp;in interface&nbsp;<code><a href="Servlet.html" title="interface in servlets">Servlet</a></code></dd>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>ri</code> - the RequestInfo containing HTTP request data including multipart content</dd>
<dd><code>toClient</code> - the OutputStream to write the HTTP response to</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code>java.io.IOException</code> - if there are errors writing to the output stream or file system operations</dd>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><code>extractFilename(String)</code>, 
<code>extractFileContent(String)</code>, 
<code>saveConfigFile(String, String)</code>, 
<a href="../configs/GenericConfig.html#create()"><code>GenericConfig.create()</code></a>, 
<a href="../views/HtmlGraphWriter.html#getGraphHTML()"><code>HtmlGraphWriter.getGraphHTML()</code></a></dd>
</dl>
</li>
</ul>
<a id="close()">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>close</h4>
<pre class="methodSignature">public&nbsp;void&nbsp;close()
           throws java.io.IOException</pre>
<div class="block"><span class="descfrmTypeLabel">Description copied from interface:&nbsp;<code><a href="Servlet.html#close()">Servlet</a></code></span></div>
<div class="block">Releases any resources held by this servlet and performs cleanup operations.
 
 <p>This method is called during server shutdown or when the servlet is being
 unregistered from the HTTP server. Implementations should:
 <ul>
 <li>Close any open files, database connections, or network resources</li>
 <li>Stop any background threads or scheduled tasks</li>
 <li>Release any cached data or temporary resources</li>
 <li>Perform any necessary state persistence</li>
 </ul>
 
 <p>For stateless servlets that don't hold external resources, this method
 may be a no-op but should still be implemented for consistency.
 
 <p>This method should be idempotent - calling it multiple times should not
 cause errors or unexpected behavior. It should also complete quickly to
 avoid delaying server shutdown.
 
 <h3>Resource Cleanup Example</h3>
 <pre><code>
 public void close() throws IOException {
     // Close database connections
     if (dataSource != null) {
         try {
             dataSource.close();
         } catch (SQLException e) {
             // Log error but don't throw - cleanup should continue
             System.err.println("Error closing database: " + e.getMessage());
         }
     }
     
     // Stop background tasks
     if (scheduledExecutor != null) {
         scheduledExecutor.shutdown();
         try {
             if (!scheduledExecutor.awaitTermination(5, TimeUnit.SECONDS)) {
                 scheduledExecutor.shutdownNow();
             }
         } catch (InterruptedException e) {
             scheduledExecutor.shutdownNow();
             Thread.currentThread().interrupt();
         }
     }
     
     // Clear caches
     if (cache != null) {
         cache.clear();
     }
     
     // Clear references
     dataSource = null;
     scheduledExecutor = null;
     cache = null;
 }
 </code></pre>
 
 <h3>Cleanup Best Practices</h3>
 <ul>
 <li>Don't throw exceptions from close() - log errors instead</li>
 <li>Use try-catch blocks around individual cleanup operations</li>
 <li>Set object references to null after cleanup</li>
 <li>Use timeouts for operations that might hang</li>
 <li>Consider using try-with-resources for automatic cleanup</li>
 </ul></div>
<dl>
<dt><span class="overrideSpecifyLabel">Specified by:</span></dt>
<dd><code><a href="Servlet.html#close()">close</a></code>&nbsp;in interface&nbsp;<code><a href="Servlet.html" title="interface in servlets">Servlet</a></code></dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code>java.io.IOException</code> - if an I/O error occurs during resource cleanup.
                     Implementations should minimize the likelihood of this
                     by handling individual cleanup failures gracefully.</dd>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><a href="Servlet.html#handle(server.RequestParser.RequestInfo,java.io.OutputStream)"><code>Servlet.handle(RequestInfo, OutputStream)</code></a></dd>
</dl>
</li>
</ul>
</li>
</ul>
</section>
</li>
</ul>
</div>
</div>
</main>
<!-- ========= END OF CLASS DATA ========= -->
<footer role="contentinfo">
<nav role="navigation">
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a id="navbar.bottom">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.bottom" title="Skip navigation links">Skip navigation links</a></div>
<a id="navbar.bottom.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../index.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../deprecated-list.html">Deprecated</a></li>
<li><a href="../index-all.html">Index</a></li>
<li><a href="../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../allclasses.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor.summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor.detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a id="skip.navbar.bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
</nav>
</footer>
</body>
</html>
